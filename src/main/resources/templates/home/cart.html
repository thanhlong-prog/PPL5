<!DOCTYPE html>
<html lang="en">

<head>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
        integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" th:href="@{/assets/css/toastmsg.css}">
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="stylesheet" href="/assets/css/header.css">
    <link rel="stylesheet" href="/assets/css/footer.css">
    <link rel="stylesheet" href="/assets/css/cart.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script th:src="@{/assets/js/toastmsg.js}"></script>

</head>

<body>
    <div id="toast"></div>
    <div class="w-cart">
        <div class="cart-header">
            <div class="w-cart-top">
                <div class="container">
                    <div class="top">
                        <div class="top-left">
                            <a href="#">K√™nh ng∆∞·ªùi b√°n</a>
                            <a class="wall" href="#">T·∫£i ·ª©ng d·ª•ng</a>
                            <div class="wall connect">
                                <span>K·∫øt n·ªëi</span>
                                <div class="w-logo">
                                    <i class='bx bxl-facebook-circle'></i>
                                    <i class='bx bxl-instagram-alt'></i>
                                </div>
                            </div>
                        </div>
                        <div class="top-right">
                            <div class="notification">
                                <div class="notification-item">
                                    <i class='bx bx-bell'></i>
                                    <span> Th√¥ng b√°o</span>
                                </div>
                                <div class="notification-box hide">
                                    <div class="icon-top"><i class="fa-solid fa-caret-up fa-2xl"
                                            style="color: #ffffff;"></i></div>
                                    <ul>
                                        <li>
                                            <a href="">
                                                <div class="w-noti">
                                                    <div class="noti-img">
                                                        <img src="/assets/images/img-noti/noti-1.png" alt="">
                                                    </div>
                                                    <div class="noti-infor">
                                                        <div class="noti-title">
                                                            <span>21H SHOPEE LIVE TUNG DEAL "ƒê·ªàNH N√ìC"</span>
                                                        </div>
                                                        <div class="noti-detail">
                                                            <span>üíñGi·∫£m ƒë·∫øn 50% ƒëa ng√†nh h√†ng ‚ú®Th·ªùi trang c√≤n m√£ gi·∫£m
                                                                ƒë·∫øn 100K üåàM·ªπ ph·∫©m c√≥ m√£ gi·∫£m ƒë·∫øn 150K üåüV√†i ti·∫øng sale
                                                                cu·ªëi - Ch·ªët s·∫°ch gi·ªè h√†ng</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="">
                                                <div class="w-noti">
                                                    <div class="noti-img">
                                                        <img src="/assets/images/img-noti/noti-1.png" alt="">
                                                    </div>
                                                    <div class="noti-infor">
                                                        <div class="noti-title">
                                                            <span>21H SHOPEE LIVE TUNG DEAL "ƒê·ªàNH N√ìC"</span>
                                                        </div>
                                                        <div class="noti-detail">
                                                            <span>üíñGi·∫£m ƒë·∫øn 50% ƒëa ng√†nh h√†ng ‚ú®Th·ªùi trang c√≤n m√£ gi·∫£m
                                                                ƒë·∫øn 100K üåàM·ªπ ph·∫©m c√≥ m√£ gi·∫£m ƒë·∫øn 150K üåüV√†i ti·∫øng sale
                                                                cu·ªëi - Ch·ªët s·∫°ch gi·ªè h√†ng</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="w-option help">
                                <i class='bx bx-help-circle'></i>
                                <span>H·ªó tr·ª£</span>
                            </div>
                            <div class="w-option language">
                                <i class='bx bx-world'></i>
                                <span>Ti·∫øng Vi·ªát</span>
                            </div>
                            <div class="w-option account">
                                <div class="avt" th:if="${user.avatar != null}"
                                    th:style="'background-image: url(' + ${user.avatar} + ')'">
                                </div>
                                <div class="avt" th:if="${user.avatar == null}">
                                </div>
                                <span th:text="${user.name != null ? user.name : ''}"></span>
                                <div class="drop-down-box account hide">
                                    <div class="icon-top"><i class="fa-solid fa-caret-up fa-2xl"
                                            style="color: #ffffff;"></i></div>
                                    <div class="title-dropdown">
                                        <p></p>
                                    </div>
                                    <ul>
                                        <li><a th:href="@{/buyer/profile}">T√†i Kho·∫£n C·ªßa T√¥i</a></li>
                                        <li>ƒê∆°n Mua</li>
                                        <li><a th:href="@{/logout}">ƒêƒÉng xu·∫•t</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="w-cart-bottom">
                <div class="container">
                    <div class="bottom">
                        <div class="bottom-left">
                            <a href="/home">
                                <img src="/assets/images/cart/logo.png" alt="shopee-icon">
                            </a>
                        </div>
                        <div class="bottom-main">
                            <form class="w-search" action="">
                                <input class="input-search" type="text"
                                    placeholder="T√¨m s·∫£n ph·∫©m, th∆∞∆°ng hi·ªáu, v√† t√™n shop">
                                <button class="submit-search" type="submit">
                                    <i class='bx bx-search'></i>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="cart-main">
            <div class="container">
                <div class="w-cart-item"></div>
                <div class="cart-main-top">
                    <div class="left">
                        <!-- <input type="checkbox" id="check-all"> -->
                        <label for="check-all">S·∫£n ph·∫©m</label>
                    </div>
                    <div class="right">
                        <span class="flex-column-1">ƒê∆°n Gi√°</span>
                        <span class="flex-column-1">S·ªë L∆∞·ª£ng</span>
                        <span class="flex-column-1">S·ªë Ti·ªÅn</span>
                        <span class="flex-column-1">Thao T√°c</span>
                    </div>
                </div>
                <div th:attr="data-id-checked=${checkedId}"></div>
                <div th:each="item : ${cartList}">
                    <div class="cart-item"
                        th:attr="data-id=${item.id}, data-price=${item.product.discount != null ? item.product.price * item.product.discount / 100 * item.orderQuantity : item.product.price * item.orderQuantity}">
                        <div class="top">
                            <div class="shop-info">
                                <!-- <input type="checkbox" id="check-shop"> -->
                                <!-- <div class="tag">
                                    <img src="/assets/images/cart/tag-yeu-thich.svg" alt="">
                                </div> -->
                                <label for="check-shop" th:text="'Shop: '+${item.product.seller.name}"></label>
                            </div>
                        </div>
                        <div class="center">
                            <div class="left">
                                <div class="img-product">
                                    <input type="checkbox" class="check-item">
                                    <a th:href="@{/buyer/product(productId = ${item.product.id})}">
                                        <img th:src="${item.product.thumbnail}" alt="">
                                    </a>
                                </div>
                                <div class="title">
                                    <span th:text="${item.product.title}">
                                    </span>
                                    <div class="tag">
                                        <img src="/assets/images/cart/tag-voucher.png" alt="">
                                    </div>
                                </div>
                                <div class="variations">
                                    <div th:if="${item.productVatiants != null}">
                                        <span>Ph√¢n Lo·∫°i H√†ng:</span><br>

                                        <span class="variation-info"
                                            th:each="optionValue : ${item.productVatiants.optionValues}">
                                            <span
                                                th:text="${optionValue.option.name + ': ' + optionValue.value}"></span><br>
                                        </span>
                                    </div>
                                    <div th:if="${item.productVatiants == null}">
                                        <span>Ph√¢n Lo·∫°i:</span><br>
                                        <span class="variation-info">
                                            <span>Kh√¥ng c√≥</span><br>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="right">
                                <div class="price flex-column-1">
                                    <div th:if="${item.productVatiants != null}">
                                        <span th:if="${item.product.discount != null}" class="price-old"
                                            th:text="'‚Ç´' + ${item.productVatiants.price}"></span>
                                        <span th:if="${item.product.discount != null}" class="price-new"
                                            th:text="'‚Ç´' + ${item.productVatiants.price*(100-item.product.discount)/100}"></span>
                                        <span th:if="${item.product.discount == null || item.product.discount == 0}"
                                            class="price-new" th:text="'‚Ç´' + ${item.productVatiants.price}"></span>
                                    </div>
                                    <div th:if="${item.productVatiants == null}">
                                        <span th:if="${item.product.discount != null}" class="price-old"
                                            th:text="'‚Ç´' + ${item.product.price}"></span>
                                        <span th:if="${item.product.discount != null}" class="price-new"
                                            th:text="'‚Ç´' + ${item.product.price*(100-item.product.discount)/100}"></span>
                                        <span th:if="${item.product.discount == null || item.product.discount == 0}"
                                            class="price-new" th:text="'‚Ç´' + ${item.product.price}"></span>
                                    </div>
                                </div>
                                <div class="quantity flex-column-1">
                                    <button class="minus">-</button>
                                    <input id="quantity-product" type="text" th:value="${item.orderQuantity}" readonly>
                                    <button class="plus">+</button>
                                </div>
                                <div class="total-price flex-column-1">
                                    <span class="total-price-text" th:if="${item.product.discount != null}"
                                        th:text="'‚Ç´' + ${item.product.price * (100-item.product.discount) / 100 * item.orderQuantity}"></span>
                                    <span class="total-price-text"
                                        th:if="${item.product.discount == null || item.product.discount == 0}"
                                        th:text="'‚Ç´' + ${item.product.price * item.orderQuantity}"></span>
                                </div>
                                <div class="btn-option flex-column-1">
                                    <button class="btn-delete" th:onclick="'delCartItem('+ ${item.id} +')'">
                                        Xo√°</button>
                                    <!-- <button class="btn-find-similar">T√¨m s·∫£n ph·∫©m t∆∞∆°ng t·ª±</button> -->
                                </div>
                            </div>
                        </div>
                        <div class="bottom"></div>
                    </div>
                </div>
                <script>
                    function delCartItem(cartId) {
                        $.ajax({
                            type: "POST",
                            url: "/buyer/cart/delete",
                            data: {
                                cartId: cartId
                            },
                            success: function (res) {
                                if (res == "success") {
                                    $(`.cart-item[data-id="${cartId}"]`).remove();
                                    cartItems = document.querySelectorAll(".cart-item");
                                    totalItemCount = cartItems.length;
                                    document.getElementById("num-products").textContent = "(" + totalItemCount + ")";
                                    toast({
                                        title: 'Th√†nh c√¥ng',
                                        content: 'Th√™m v√†o gi·ªè h√†ng th√†nh c√¥ng',
                                        type: 'success',
                                        duration: 2000
                                    });
                                }
                            },
                            error: function (err) {
                                toast({
                                    title: 'Th·∫•t b·∫°i',
                                    content: err.responseText,
                                    type: 'error',
                                    duration: 2000
                                });
                            }
                        })
                    }

                    function updateCartItem(cartId, quantity) {
                        $.ajax({
                            type: "POST",
                            url: "/buyer/cart/updateQuantity",
                            data: {
                                cartId: cartId,
                                quantity: quantity
                            },
                            success: function (res) {
                                const item = $(`.cart-item[data-id="${cartId}"]`);
                                const priceSpan = item.find(".total-price .total-price-text");
                                priceSpan.text(`‚Ç´${res.totalPrice.toLocaleString('vi-VN')}`);
                                toast({
                                    title: 'Th√†nh c√¥ng',
                                    content: 'C·∫≠p nh·∫≠t gi·ªè h√†ng th√†nh c√¥ng',
                                    type: 'success',
                                    duration: 2000
                                });
                                updateTotalChecked();
                                updateTotalPriceChecked();
                            },
                            error: function (err) {
                                toast({
                                    title: 'Th·∫•t b·∫°i',
                                    content: err.responseText,
                                    type: 'error',
                                    duration: 2000
                                });
                            }
                        });
                    }
                </script>
                <div class="cart-main-bottom">
                    <div class="select-voucher">
                        <div class="voucher">
                            <i class='bx bxs-discount'></i>
                            <span>Shopee Voucher</span>
                        </div>
                        <div class="option">
                            <span>Ch·ªçn ho·∫∑c nh·∫≠p m√£</span>
                        </div>
                    </div>
                    <div class="shopee-coins">
                        <div class="left">
                            <div class="check">
                                <input type="checkbox" id="check-shopee-coins">
                                <img src="/assets/images/cart/shopee-coins.svg" alt="">
                                <label for="check-shopee-coins">Shopee Xu</label>
                            </div>
                            <span>
                                D√πng 100 Shopee Xu
                            </span>
                        </div>
                        <div class="right">
                            <div class="discount">
                                -‚Ç´100
                            </div>
                        </div>
                    </div>
                    <div class="all-total-price">
                        <div class="left">
                            <div class="select-products">
                                <input type="checkbox" id="check-all-products">
                                <label for="check-all-products">Ch·ªçn T·∫•t C·∫£</label>
                                <span id="num-products">(2)</span>
                            </div>
                            <div class="btn-delete">
                                <button class="delete">Xo√°</button>
                            </div>
                            <!-- <div class="move">
                                <button class="move-my-likes">
                                    L∆∞u v√†o m·ª•c ƒê√£ th√≠ch
                                </button>
                            </div> -->
                        </div>
                        <div class="right">
                            <div class="total-product">
                                <span>T·ªïng c·ªông</span>
                                <span id="total-checked">(0 s·∫£n ph·∫©m):</span>
                            </div>
                            <div class="total-price">
                                <span id="total-price-checked">‚Ç´0</span>
                            </div>
                            <div class="btn-buy">
                                <button class="buy" onclick="checkout()">Mua h√†ng</button>
                            </div>
                            <script>
                                function checkout() {
                                    const checkedItems = document.querySelectorAll(".cart-item .check-item:checked");
                                    if (checkedItems.length === 0) {
                                        toast({
                                            title: 'Th·∫•t b·∫°i',
                                            content: 'Vui l√≤ng ch·ªçn s·∫£n ph·∫©m ƒë·ªÉ thanh to√°n',
                                            type: 'error',
                                            duration: 2000
                                        });
                                        return;
                                    }
                                    const cartIds = Array.from(checkedItems).map(item => item.closest('.cart-item').dataset.id);
                                    window.location.href = `/buyer/payment?cartIds=${cartIds.join(',')}`;
                                }
                            </script>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- <div class="w-products-similar">
        <div class="container">
            <div class="products-similar">
                <div class="product">
                    <div class="image">
                        <img src="/assets/images/img-products/product-1.webp" alt="">
                    </div>
                    <div class="infor">
                        <div class="top">
                            <div class="name">
                                <span>D√¢y S·∫°c T·ª± Ng·∫Øt - D√¢y C√°p S·∫°c D·ªØ Li·ªáu S·∫°c Nhanh 100W Micro USB Type C 3 Trong 1 6A</span>
                            </div>
                            <div class="tag">
                            </div>
                        </div>
                        <div class="bottom">
                            <div class="price">
                                <span>100.000ƒë</span>
                            </div>
                            <div class="count">
                                <span>ƒê√£ b√°n 1000</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> -->
        <div class="footer">
            <div th:insert="~{footer :: footer}"></div>
        </div>
</body>
<script src="/assets/js/header.js"></script>
<script th:src="@{/assets/js/cart.js}"></script>